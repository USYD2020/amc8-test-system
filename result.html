<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC8 æµ‹è¯•ç»“æœ</title>
    
    <!-- å¤–éƒ¨èµ„æº -->
    <link href="https://cdn.staticfile.org/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e40af;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --dark-bg: #1f2937;
            --dark-card: #374151;
        }

        * {
            font-family: 'Noto Sans SC', Tahoma, Arial, Roboto, "Droid Sans", "Helvetica Neue", "Droid Sans Fallback", "Heiti SC", "Hiragino Sans GB", Simsun, sans-serif;
        }

        body {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .result-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
        }

        .score-circle {
            width: auto;
            height: auto;
            border-radius: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: transparent;
            padding: 1rem;
        }
        
        .score-progress-container {
            width: 280px;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-top: 1rem;
            border: 1px solid #d1d5db;
        }
        
        .score-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
            border-radius: 10px;
            transition: width 1s ease-out;
            width: 0%;
        }
        
        .score-progress-text {
            display: none; /* éšè—è¿›åº¦æ¡ä¸­å¿ƒæ–‡å­—ï¼Œé¿å…é‡å¤æ˜¾ç¤º */
        }
        
        /* å±å¹•æ˜¾ç¤ºæ—¶éšè—æ–¹å—è®¾è®¡ï¼Œä»…PDFæ˜¾ç¤º */
        .score-blocks-container {
            display: none;
        }

        .score-content {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .class-badge {
            background: linear-gradient(135deg, var(--class-color, #3b82f6) 0%, var(--class-color-dark, #1e40af) 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 2rem;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow: 0 8px 25px -5px var(--class-color, #3b82f6);
        }

        .subject-bar {
            transition: all 0.8s ease;
            transform-origin: left center;
        }

        .animate-bar {
            animation: growBar 1s ease-out forwards;
        }

        @keyframes growBar {
            from { width: 0%; }
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 2rem 0;
            /* æ·»åŠ flexboxå±…ä¸­å¸ƒå±€ */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* é›·è¾¾å›¾Canvasé«˜åˆ†è¾¨ç‡è®¾ç½® */
        #radar-chart {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            /* ç¡®ä¿Canvasæ­£ç¡®å®šä½ */
            max-width: 100%;
            max-height: 100%;
        }

        /* ç¥è´ºåŠ¨ç”»æ ·å¼ */
        .congratulations-banner {
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.9) 0%, 
                rgba(99, 102, 241, 0.8) 50%, 
                rgba(168, 85, 247, 0.9) 100%);
            border-radius: 20px;
            margin-bottom: 2rem;
            overflow: hidden;
            position: relative;
        }

        .congratulations-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: sparkle 3s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.7; }
        }

        .congratulations-content {
            position: relative;
            z-index: 1;
            padding: 2.5rem;
            text-align: center;
            color: white;
        }

        .congratulations-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .congratulations-name {
            font-size: 2.8rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .congratulations-grade {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1rem 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .congratulations-message {
            font-size: 1.2rem;
            opacity: 0.95;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            margin-top: 1rem;
            line-height: 1.4;
        }

        /* å¯¼èˆªæ æ ·å¼ä¼˜åŒ– - ä½¿ç”¨æŸ”å’Œçš„ç´«è‰²è°ƒ */
        .navbar {
            background: linear-gradient(135deg, 
                rgba(79, 70, 229, 0.9) 0%, 
                rgba(99, 102, 241, 0.85) 50%, 
                rgba(129, 140, 248, 0.8) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(79, 70, 229, 0.15);
        }

        .navbar .nav-brand-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        .navbar .nav-button {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.2) 0%, 
                rgba(255, 255, 255, 0.15) 100%);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: white;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .navbar .nav-button:hover {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.3) 0%, 
                rgba(255, 255, 255, 0.25) 100%);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .navbar .nav-button-success {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.8) 0%, 
                rgba(5, 150, 105, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }

        .navbar .nav-button-success:hover {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.9) 0%, 
                rgba(5, 150, 105, 0.9) 100%);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
        }

        .navbar .nav-text-primary {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .navbar .nav-text-secondary {
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* æ·±è‰²æ¨¡å¼ */
        .dark {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        .dark .result-card {
            background: rgba(31, 41, 55, 0.95);
            color: #f9fafb;
        }

        .dark .text-gray-900 {
            color: #f9fafb !important;
        }

        .dark .text-gray-600 {
            color: #9ca3af !important;
        }

        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out;
        }

        .animate-delay-200 { animation-delay: 0.2s; }
        .animate-delay-400 { animation-delay: 0.4s; }
        .animate-delay-600 { animation-delay: 0.6s; }

        /* æ‰“å°ä¸“ç”¨å†…å®¹ - å±å¹•æ˜¾ç¤ºæ—¶éšè— */
        .print-only {
            display: none;
        }

        /* æ‰“å°æ ·å¼ - å…¨é¢å…¼å®¹æ€§é‡ç½® */
        @media print {
            @page {
                margin: 1.5cm;
                size: A4;
            }
            
            /* å…¨å±€PDFå…¼å®¹æ€§é‡ç½® */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body {
                background: white !important;
                color: #000000 !important;
                font-family: "Helvetica Neue", Arial, sans-serif !important;
            }
            
            /* ç§»é™¤æ‰€æœ‰ä¸å…¼å®¹çš„CSS3ç‰¹æ•ˆ */
            *,
            *::before,
            *::after {
                backdrop-filter: none !important;
                filter: none !important;
                box-shadow: none !important;
                text-shadow: none !important;
                border-radius: 8px !important; /* ä¿ç•™åŸºç¡€åœ†è§’ */
                transform: none !important;
                transition: none !important;
                animation: none !important;
            }
            .no-print {
                display: none !important;
            }
            .result-card {
                background: white !important;
                backdrop-filter: none !important;
                box-shadow: none !important;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
            
            /* ç¥è´ºæ¨ªå¹…æ‰“å°ä¼˜åŒ– - å®Œå…¨ç®€åŒ– */
            .congratulations-banner {
                background: #3b82f6 !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                border-radius: 0 !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                position: relative !important;
            }
            
            .congratulations-banner * {
                backdrop-filter: none !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }
            
            .congratulations-banner::before {
                display: none !important;
            }
            
            .congratulations-content {
                background: transparent !important;
                backdrop-filter: none !important;
            }

            .congratulations-grade {
                background: #ffffff !important;
                backdrop-filter: none !important;
                border: 2px solid #1e40af !important;
                color: #1e40af !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }
            
            /* å¯¼èˆªæ æ‰“å°éšè—ï¼ˆå·²æœ‰no-printç±»ï¼‰ */
            .navbar {
                display: none !important;
            }
            
            /* é›·è¾¾å›¾æ‰“å°ä¼˜åŒ– - éšè—Canvasæ˜¾ç¤ºæ‰“å°å›¾ç‰‡ */
            .chart-container canvas {
                display: none !important;
            }
            
            /* é›·è¾¾å›¾å®¹å™¨æ‰“å°æ—¶é€‚ä¸­å°ºå¯¸ - ç¼©å°ä»¥æé«˜æ¸…æ™°åº¦å¹¶å±…ä¸­ */
            .chart-container {
                height: 220px !important;
                margin: 0.3rem auto !important;
                width: 75% !important;
                /* ä¿æŒflexboxå±…ä¸­å¸ƒå±€ */
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                /* é˜²æ­¢å†…å®¹æº¢å‡º */
                overflow: hidden !important;
            }
            
            /* ç¡®ä¿æ‰“å°å›¾ç‰‡åœ¨å®¹å™¨å†…æ­£ç¡®å±…ä¸­ */
            .chart-container .print-chart-image {
                display: block !important;
                width: 100% !important;
                height: auto !important;
                max-height: 100% !important;
                object-fit: contain !important;
                /* é«˜è´¨é‡å›¾åƒæ¸²æŸ“è®¾ç½® */
                image-rendering: -webkit-optimize-contrast !important;
                image-rendering: crisp-edges !important;
                image-rendering: pixelated !important; /* å¤‡ç”¨é€‰é¡¹ */
                image-rendering: high-quality !important; /* é«˜è´¨é‡æ¸²æŸ“ */
                -ms-interpolation-mode: bicubic !important; /* IEå…¼å®¹ */
                /* å¼ºåˆ¶é¢œè‰²ä¿æŠ¤ */
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                /* é˜²æ­¢å›¾åƒæ¨¡ç³Š */
                backface-visibility: hidden !important;
                -webkit-backface-visibility: hidden !important;
            }
            
            /* åˆ†æå›¾è¡¨åˆå¹¶å¸ƒå±€ä¼˜åŒ– - ç´§å‡‘ä¸Šä¸‹å¸ƒå±€ */
            .analysis-section {
                display: grid !important;
                grid-template-columns: 1fr !important;
                grid-template-rows: auto auto !important;
                gap: 1rem !important;
                page-break-inside: avoid !important;
                margin-bottom: 1.5rem !important;
            }
            
            .analysis-section .result-card {
                margin-bottom: 0 !important;
                padding: 1rem !important;
            }
            
            /* èƒ½åŠ›åˆ†ææ ‡é¢˜é—´è·ä¼˜åŒ– */
            .analysis-section h3 {
                margin-bottom: 0.5rem !important;
                font-size: 1.1rem !important;
            }
            
            /* ç§‘ç›®è¡¨ç°æ¡æ‰“å°ä¼˜åŒ– */
            .subject-bar {
                background: linear-gradient(to right, #3b82f6 0%, #1e40af 100%) !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
                border: 1px solid #3b82f6;
            }
            
            /* åˆ†æ•°æ˜¾ç¤ºåŒºåŸŸé‡æ–°è®¾è®¡ */
            .score-circle {
                width: auto !important;
                height: auto !important;
                border-radius: 0 !important;
                background: transparent !important;
                border: none !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                padding: 2rem !important;
            }
            
            /* åˆ†æ•°æ•°å­—æ˜¾ç¤º - ç©ºç™½ä¼˜åŒ–ç‰ˆ */
            .score-content {
                text-align: center !important;
                margin-bottom: 0.1rem !important;
            }
            
            /* PDFä¸“ç”¨ï¼šæ˜¾ç¤ºæ–¹å—ç½‘æ ¼è®¾è®¡ - å¤§å¹…ä¼˜åŒ–ç©ºé—´åˆ©ç”¨ç‰ˆ */
            .score-blocks-container {
                display: block !important;
                width: 280px !important;
                margin: 0.05rem auto !important;
            }
            
            .score-blocks-grid {
                display: grid !important;
                grid-template-columns: repeat(5, 1fr) !important;
                gap: 3px !important;
                margin-bottom: 0.05rem !important;
            }
            
            .score-block {
                width: 35px !important;
                height: 25px !important;
                border-radius: 4px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                font-size: 10px !important;
                font-weight: bold !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .score-block.correct {
                background: #10b981 !important; /* ç»¿è‰² - æ­£ç¡® */
            }
            
            .score-block.incorrect {
                background: #9ca3af !important; /* ç°è‰² - é”™è¯¯ */
            }
            
            .score-block.unanswered {
                background: #e5e7eb !important; /* æµ…ç°è‰² - æœªç­” */
                color: #6b7280 !important;
            }
            
            /* æ•°æ®ç»Ÿè®¡ - å¤§å¹…ä¼˜åŒ–å¯è¯»ç‰ˆ */
            .score-stats-row {
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                gap: 0.4rem !important;
                text-align: center !important;
                font-size: 12px !important;
                color: #1f2937 !important;
                line-height: 1.2 !important;
                margin-top: 0.05rem !important;
            }
            
            .score-stat-card {
                display: inline !important;
                padding: 0.2rem 0.5rem !important;
                background: #f3f4f6 !important;
                border-radius: 4px !important;
                font-weight: bold !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                border: 1px solid #e5e7eb !important;
            }
            
            .score-stat-number {
                font-size: 9px !important;
                font-weight: bold !important;
                color: #1f2937 !important;
            }
            
            .score-stat-label {
                display: none !important; /* éšè—æ ‡ç­¾ï¼ŒèŠ‚çœç©ºé—´ */
            }
            
            /* éšè—åŸè¿›åº¦æ¡ */
            .score-progress-container,
            .score-progress-fill,
            .score-progress-text {
                display: none !important;
            }
            
            /* ç­å‹æ¨èæ‰“å°ä¼˜åŒ– */
            .class-badge {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
                border: 2px solid currentColor;
            }
            
            /* åˆ†é¡µæ§åˆ¶ */
            .animate-fade-in-up {
                page-break-inside: avoid;
            }
            
            /* ç¡®ä¿è¡¨æ ¼å®Œæ•´æ˜¾ç¤º */
            table {
                page-break-inside: avoid;
            }
            
            /* å­—ä½“å¤§å°è°ƒæ•´ */
            h1, h2, h3 {
                page-break-after: avoid;
            }
            
            /* æ‰“å°æ—¶æ˜¾ç¤ºå®Œæ•´é¢˜ç›®å†…å®¹åŒºåŸŸ */
            .print-only {
                display: block !important;
            }
            
            /* é¢˜ç›®å†…å®¹æ ·å¼ */
            .question-item {
                page-break-inside: avoid;
                margin-bottom: 2rem;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                padding: 1.5rem;
                background: white !important;
            }
            
            .question-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .question-number {
                font-size: 1.1rem;
                font-weight: bold;
                color: #1f2937;
            }
            
            .question-subject {
                font-size: 0.875rem;
                color: #6b7280;
                background: #f3f4f6;
                padding: 0.25rem 0.75rem;
                border-radius: 12px;
            }
            
            .question-content {
                margin-bottom: 1rem;
            }
            
            .question-text {
                margin-bottom: 0.75rem;
                line-height: 1.5;
            }
            
            .question-text.chinese {
                color: #374151;
                font-size: 0.95rem;
            }
            
            .question-text.english {
                color: #6b7280;
                font-size: 0.9rem;
                font-style: italic;
            }
            
            .question-options {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .option-item {
                display: flex;
                align-items: center;
                padding: 0.5rem;
                border: 1px solid #e5e7eb;
                border-radius: 6px;
                background: #f9fafb;
            }
            
            .option-label {
                font-weight: bold;
                margin-right: 0.5rem;
                min-width: 1.5rem;
            }
            
            .question-answers {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 1rem;
                padding-top: 1rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .answer-info {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .student-answer, .correct-answer {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.875rem;
            }
            
            .answer-label {
                color: #6b7280;
            }
            
            .answer-value {
                font-weight: bold;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
            }
            
            .answer-value.correct {
                background: #d1fae5;
                color: #065f46;
                border: 1px solid #10b981;
            }
            
            .answer-value.incorrect {
                background: #fee2e2;
                color: #991b1b;
                border: 1px solid #ef4444;
            }
            
            .answer-value.unanswered {
                background: #f3f4f6;
                color: #6b7280;
                border: 1px solid #d1d5db;
            }
            
            .result-status {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-weight: bold;
                font-size: 0.875rem;
            }
            
            .result-status.correct {
                color: #065f46;
            }
            
            .result-status.incorrect {
                color: #991b1b;
            }
            
            .result-status.unanswered {
                color: #6b7280;
            }
            
            /* åˆ†é¡µæ§åˆ¶ */
            .page-break-before {
                page-break-before: always;
            }
        }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalIn 0.3s ease-out;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            text-align: center;
        }

        .modal-qr-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .modal-resources {
            text-align: left;
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #10b981;
            margin-bottom: 1.5rem;
        }

        .modal-resources h4 {
            color: #047857;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* å…è´¹èµ„æ–™åŒ…æ ·å¼ */
        .free-resources-section {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
        }

        .free-resources-section h4 {
            color: #047857;
        }

        /* å†…éƒ¨ä¸“ç ”èµ„æ–™åŒ…æ ·å¼ */
        .premium-resources-section {
            background: #faf5ff;
            border-left: 4px solid #9333ea;
        }

        .premium-resources-section h4 {
            color: #7c3aed;
            display: flex;
            align-items: center;
        }

        /* å†…æµ‹é˜¶æ®µç‰¹æ®Šæ ·å¼ */
        .premium-preview-section {
            position: relative;
            background: linear-gradient(135deg, #f3e8ff 0%, #ede9fe 100%);
            border: 1px solid #c4b5fd;
        }

        .premium-preview-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #9333ea, #c084fc, #9333ea);
            border-radius: 10px;
            z-index: -1;
            opacity: 0.3;
        }

        /* èµ„æ–™é¢„è§ˆå›¾ç‰‡æ‚¬åœæ•ˆæœ */
        .resource-preview-item {
            transition: transform 0.2s ease;
        }

        .resource-preview-item:hover {
            transform: translateY(-2px);
        }

        .resource-preview-item img {
            transition: all 0.2s ease;
        }

        .resource-preview-item:hover img {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .modal-link-box {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .modal-link-box strong {
            color: #1f2937;
            display: block;
            margin-bottom: 0.5rem;
        }

        .modal-link-box a {
            color: #2563eb;
            text-decoration: none;
            word-break: break-all;
        }

        .modal-link-box a:hover {
            text-decoration: underline;
        }

        .modal-extract-code {
            background: #fef3c7;
            color: #d97706;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .modal-dual-images {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .modal-dual-images img {
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* ä¸ªäººå¾®ä¿¡äºŒç»´ç æ·»åŠ ç™½è‰²èƒŒæ™¯ - å…¨é¢è¦†ç›–æ‰€æœ‰æ¨¡æ€æ¡† */
        .modal-dual-images img[alt*="ä¸ªäººå¾®ä¿¡"],
        .modal-dual-images img[alt*="è€å¸ˆå¾®ä¿¡"], 
        .modal-dual-images img[alt*="å¾®ä¿¡"],
        img[alt*="è€å¸ˆå¾®ä¿¡äºŒç»´ç "],
        img[alt*="ä¸ªäººå¾®ä¿¡äºŒç»´ç "],
        img[alt*="å¾®ä¿¡äºŒç»´ç "],
        .modal-body img[alt*="å¾®ä¿¡"],
        #study-group-modal img[alt*="ä¸ªäººå¾®ä¿¡"],
        #study-group-modal img[alt*="å¾®ä¿¡äºŒç»´ç "] {
            background-color: white !important;
            padding: 8px;
            border-radius: 8px;
        }

        .modal-image-label {
            text-align: center;
            font-weight: 600;
            color: #374151;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .copy-btn {
            min-width: 70px;
            font-size: 0.875rem;
            cursor: pointer;
            border: none;
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background-color: #10b981 !important;
        }

        .copy-btn.copied:hover {
            background-color: #059669 !important;
        }

        /* å¤åˆ¶æˆåŠŸæç¤º */
        .copy-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .copy-toast.show {
            opacity: 1;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }

            .modal-dual-images {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .copy-btn {
                min-width: 60px;
                font-size: 0.75rem;
                padding: 0.5rem 0.75rem;
            }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .score-circle {
                width: 150px;
                height: 150px;
            }
            
            .score-circle::before {
                width: 120px;
                height: 120px;
            }

            .congratulations-content {
                padding: 2rem 1.5rem;
            }

            .congratulations-name {
                font-size: 2.2rem;
            }

            .congratulations-message {
                font-size: 1rem;
            }

            .congratulations-icon {
                font-size: 3rem;
            }

            .congratulations-grade {
                font-size: 1rem;
                padding: 0.4rem 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="nav-brand-icon w-10 h-10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white nav-text-primary">æµ‹è¯•ç»“æœ</h1>
                        <p class="text-sm text-white nav-text-secondary opacity-90" id="user-info">æ­£åœ¨åŠ è½½...</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- å¯¼å‡ºæŒ‰é’® -->
                    <button id="export-pdf" 
                            class="nav-button flex items-center space-x-2 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-download"></i>
                        <span class="hidden sm:inline">å¯¼å‡ºPDF</span>
                    </button>
                    
                    <!-- é‡æ–°æµ‹è¯• -->
                    <button id="retake-test" 
                            class="nav-button nav-button-success flex items-center space-x-2 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-redo"></i>
                        <span class="hidden sm:inline">é‡æ–°æµ‹è¯•</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- ç¥è´ºæ¨ªå¹… -->
        <div class="congratulations-banner animate-fade-in-up">
            <div class="congratulations-content">
                <div class="congratulations-icon">
                    ğŸ‰
                </div>
                <div class="congratulations-name" id="congratulations-name">
                    æ­å–œå®Œæˆæµ‹è¯•ï¼
                </div>
                <div class="congratulations-grade" id="congratulations-grade" style="display: none;">
                    <i class="fas fa-graduation-cap mr-2"></i>
                    <span id="grade-text">å¹´çº§</span>
                </div>
                <div class="congratulations-message" id="congratulations-message">
                    æ„Ÿè°¢æ‚¨å®ŒæˆAMC8ç­å‰æµ‹è¯•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ‚¨çš„ç²¾å½©è¡¨ç°å§ï¼
                </div>
            </div>
        </div>

        <!-- æ€»ä½“æˆç»©å¡ç‰‡ -->
        <div class="result-card rounded-3xl p-8 mb-8 text-center animate-fade-in-up">
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <!-- åˆ†æ•°å±•ç¤º -->
                <div class="flex justify-center">
                    <div class="score-circle" id="score-circle">
                        <div class="score-content">
                            <div class="text-4xl font-bold text-gray-900" id="score-display">0</div>
                            <div class="text-lg text-gray-600">/ 25</div>
                        </div>
                        <!-- PDFä¸“ç”¨æ–¹å—è®¾è®¡ -->
                        <div class="score-blocks-container">
                            <!-- æ–¹å—ç½‘æ ¼æ˜¾ç¤ºç­”é¢˜æƒ…å†µ -->
                            <div class="score-blocks-grid" id="score-blocks-grid">
                                <!-- 25ä¸ªæ–¹å—å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                            </div>
                            
                            <!-- ç»Ÿè®¡æ•°æ® - å•è¡Œç´§å‡‘æ˜¾ç¤º -->
                            <div class="score-stats-row">
                                <span class="score-stat-card"><span id="stat-correct">18</span>æ­£ç¡®</span>
                                <span class="score-stat-card"><span id="stat-wrong">7</span>é”™è¯¯</span>
                                <span class="score-stat-card"><span id="stat-accuracy">72%</span>å¾—åˆ†</span>
                            </div>
                        </div>
                        
                        <!-- åŸè¿›åº¦æ¡ä¿ç•™ç»™HTMLæ˜¾ç¤º -->
                        <div class="score-progress-container">
                            <div class="score-progress-fill" id="score-progress-fill"></div>
                            <div class="score-progress-text" id="score-progress-text">0%</div>
                        </div>
                    </div>
                </div>

                <!-- ç­å‹æ¨è -->
                <div class="text-center md:text-left">
                    <div class="mb-6">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">æµ‹è¯•æˆç»©åˆ†æ</h2>
                        <p class="text-gray-600" id="test-summary">æ­£åœ¨åˆ†æä½ çš„æµ‹è¯•ç»“æœ...</p>
                    </div>
                    
                    <div class="class-badge inline-block mb-4" id="class-recommendation">
                        æ¨èç­å‹åŠ è½½ä¸­...
                    </div>
                    
                    <div class="flex justify-center md:justify-start space-x-6 text-sm">
                        <div class="text-center">
                            <div class="font-semibold text-gray-900" id="answered-count">0</div>
                            <div class="text-gray-500">å·²ç­”é¢˜æ•°</div>
                        </div>
                        <div class="text-center">
                            <div class="font-semibold text-gray-900" id="correct-count">0</div>
                            <div class="text-gray-500">æ­£ç¡®é¢˜æ•°</div>
                        </div>
                        <div class="text-center">
                            <div class="font-semibold text-gray-900" id="accuracy-rate">0%</div>
                            <div class="text-gray-500">å‡†ç¡®ç‡</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯¦ç»†åˆ†æ -->
        <div class="analysis-section grid lg:grid-cols-2 gap-8 mb-8">
            <!-- èƒ½åŠ›é›·è¾¾å›¾ -->
            <div class="result-card rounded-2xl p-6 animate-fade-in-up animate-delay-200">
                <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-chart-radar mr-2 text-blue-600"></i>
                    èƒ½åŠ›åˆ†æ
                </h3>
                <div class="chart-container">
                    <canvas id="radar-chart"></canvas>
                </div>
            </div>

            <!-- ç§‘ç›®åˆ†æ -->
            <div class="result-card rounded-2xl p-6 animate-fade-in-up animate-delay-400">
                <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-chart-bar mr-2 text-green-600"></i>
                    ç§‘ç›®è¡¨ç°
                </h3>
                <div id="subject-analysis" class="space-y-4">
                    <!-- ç§‘ç›®åˆ†æå°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- å­¦ä¹ å»ºè®® -->
        <div class="result-card rounded-2xl p-8 mb-8 animate-fade-in-up animate-delay-600">
            <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-lightbulb mr-3 text-yellow-500"></i>
                ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®
            </h3>
            
            <div class="prose max-w-none">
                <div id="evaluation-text" class="text-gray-700 leading-relaxed whitespace-pre-line mb-6">
                    æ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–è¯„ä»·...
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- ä¼˜åŠ¿é¢†åŸŸ -->
                    <div>
                        <h4 class="text-lg font-semibold text-green-600 mb-3">
                            <i class="fas fa-thumbs-up mr-2"></i>ä¼˜åŠ¿é¢†åŸŸ
                        </h4>
                        <div id="strengths-list" class="space-y-2">
                            <!-- ä¼˜åŠ¿åˆ—è¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- æå‡å»ºè®® -->
                    <div>
                        <h4 class="text-lg font-semibold text-red-600 mb-3">
                            <i class="fas fa-arrow-up mr-2"></i>æå‡å»ºè®®
                        </h4>
                        <div id="improvements-list" class="space-y-2">
                            <!-- æå‡å»ºè®®å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯¦ç»†é¢˜ç›®åˆ†æ -->
        <div class="result-card rounded-2xl p-8 animate-fade-in-up animate-delay-600">
            <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-list-alt mr-3 text-purple-600"></i>
                è¯¦ç»†é¢˜ç›®åˆ†æ
            </h3>
            
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-gray-50 border-b">
                            <th class="text-left py-3 px-4 font-semibold">é¢˜å·</th>
                            <th class="text-left py-3 px-4 font-semibold">ç§‘ç›®</th>
                            <th class="text-left py-3 px-4 font-semibold">éš¾åº¦</th>
                            <th class="text-left py-3 px-4 font-semibold">ä½ çš„ç­”æ¡ˆ</th>
                            <th class="text-left py-3 px-4 font-semibold">æ­£ç¡®ç­”æ¡ˆ</th>
                            <th class="text-left py-3 px-4 font-semibold">ç»“æœ</th>
                        </tr>
                    </thead>
                    <tbody id="detailed-results">
                        <!-- è¯¦ç»†ç»“æœå°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é¢˜ç›®å†…å®¹å·²ç§»è‡³ç‹¬ç«‹é¡µé¢ questions-review.html -->
        <!-- é¢˜ç›®å†…å®¹å®¹å™¨å·²ç¦ç”¨ï¼Œé¢˜ç›®å†…å®¹è¯·è®¿é—®questions-review.htmlæŸ¥çœ‹ -->
        <!-- <div id="questions-content-container" class="print-only" style="display: none;"></div> -->

        <!-- æŸ¥çœ‹é¢˜ç›®æŒ‰é’® -->
        <div class="result-card rounded-2xl p-8 text-center mb-8">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">
                <i class="fas fa-list-check mr-3 text-indigo-600"></i>
                æŸ¥çœ‹å®Œæ•´é¢˜ç›®ä¸ç­”æ¡ˆ
            </h3>
            <p class="text-gray-600 mb-6">å›é¡¾æ‰€æœ‰é¢˜ç›®ï¼Œå¯¹æ¯”ä½ çš„ç­”æ¡ˆä¸æ­£ç¡®ç­”æ¡ˆï¼Œäº†è§£é”™é¢˜åŸå› </p>
            
            <button onclick="viewQuestions()" class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg transition-all transform hover:scale-105 shadow-lg">
                <i class="fas fa-book-open mr-2"></i>
                æŸ¥çœ‹é¢˜ç›®ä¸ç­”æ¡ˆè§£æ
            </button>
        </div>

        <!-- åº•éƒ¨è¡ŒåŠ¨å»ºè®® -->
        <div class="result-card rounded-2xl p-8 text-center no-print">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">ä¸‹ä¸€æ­¥è¡ŒåŠ¨</h3>
            <p class="text-gray-600 mb-6">æ ¹æ®ä½ çš„æµ‹è¯•è¡¨ç°ï¼Œæˆ‘ä»¬ä¸ºä½ åˆ¶å®šäº†ä¸“å±çš„å­¦ä¹ è·¯å¾„</p>
            
            <div class="flex flex-wrap justify-center gap-4">
                <button onclick="openModal('consultation-modal')" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all">
                    <i class="fas fa-phone mr-2"></i>
                    é¢„çº¦å’¨è¯¢
                </button>
                <button onclick="openModal('resources-modal')" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-all">
                    <i class="fas fa-book mr-2"></i>
                    è·å–å­¦ä¹ èµ„æ–™
                </button>
                <button onclick="openModal('study-group-modal')" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all">
                    <i class="fas fa-users mr-2"></i>
                    åŠ å…¥å­¦ä¹ ç¾¤
                </button>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg text-white py-8 mt-16 no-print">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-calculator text-white text-sm"></i>
                </div>
                <span class="font-semibold">AMC8 ç­å‰æµ‹è¯•ç³»ç»Ÿ</span>
            </div>
            <p class="text-gray-200 mb-2">Â© 2025 Jeffè€å¸ˆ. AMCæ•°å­¦ç«èµ›ä¸“ä¸šåŸ¹è®­.</p>
            <p class="text-gray-300 text-sm">æœ¬æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œå…·ä½“å­¦ä¹ å®‰æ’è¯·å’¨è¯¢ä¸“ä¸šæ•™å¸ˆ</p>
        </div>
    </footer>

    <!-- å¼¹çª—æ¨¡æ€æ¡† -->
    <!-- é¢„çº¦å’¨è¯¢å¼¹çª— -->
    <div id="consultation-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-phone mr-2 text-blue-600"></i>
                    é¢„çº¦è¯¾ç¨‹å’¨è¯¢
                </h3>
                <button class="modal-close" onclick="closeModal('consultation-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-gray-600 mb-4">æ‰«æäºŒç»´ç ï¼Œæ·»åŠ ä¸“ä¸šè¯¾ç¨‹é¡¾é—®å¾®ä¿¡ï¼Œè·å–ä¸€å¯¹ä¸€å’¨è¯¢æœåŠ¡</p>
                <img src="images/AMCè¯¾ç¨‹å’¨è¯¢.png" alt="Jeffè€å¸ˆAMCè¯¾ç¨‹å’¨è¯¢äºŒç»´ç " class="modal-qr-image">
                <p class="text-sm text-gray-500 mt-4">
                    <i class="fas fa-clock mr-1"></i>
                    å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨æ—¥ 9:00-21:00
                </p>
            </div>
        </div>
    </div>

    <!-- è·å–å­¦ä¹ èµ„æ–™å¼¹çª— -->
    <div id="resources-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-book mr-2 text-green-600"></i>
                    è·å–å­¦ä¹ èµ„æ–™
                </h3>
                <button class="modal-close" onclick="closeModal('resources-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- å…è´¹å­¦ä¹ èµ„æ–™åŒ… -->
                <div class="modal-resources free-resources-section">
                    <h4>
                        <i class="fas fa-gift mr-2 text-green-600"></i>
                        å…è´¹å­¦ä¹ èµ„æ–™åŒ…
                    </h4>
                    <p class="text-gray-600 mb-4">
                        âœ¨ Aopsæ•°å­¦ç«èµ›23æœ¬å…¨å¥—æ•™æå¸¦ç­”æ¡ˆ + AMCå†å¹´çœŸé¢˜åº“
                    </p>
                    
                    <!-- å…è´¹èµ„æ–™é¢„è§ˆå›¾ç‰‡åŒºåŸŸ -->
                    <div class="resources-preview-container mb-6">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="resource-preview-item">
                                <img src="assets/images/resource-preview-1.jpg" alt="Aopsæ•™æé¢„è§ˆ" class="w-full h-32 object-cover rounded-lg shadow-md">
                                <p class="text-xs text-gray-500 text-center mt-1">Aopsç«èµ›æ•™æ</p>
                            </div>
                            <div class="resource-preview-item">
                                <img src="assets/images/resource-preview-2.jpg" alt="AMCçœŸé¢˜åº“é¢„è§ˆ" class="w-full h-32 object-cover rounded-lg shadow-md">
                                <p class="text-xs text-gray-500 text-center mt-1">AMCå†å¹´çœŸé¢˜</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VIPç”¨æˆ·å…è´¹èµ„æ–™ä¸‹è½½åŒºåŸŸ -->
                    <div id="free-resources-download" class="modal-link-box" style="display: none;">
                        <div class="text-center">
                            <div class="mb-3 p-2 bg-green-50 border border-green-200 rounded-lg">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span class="text-green-700 font-medium">æµ‹è¯•å®Œæˆï¼Œå…è´¹ä¸‹è½½</span>
                            </div>
                            <p class="text-gray-700 mb-2">
                                <strong>ğŸ“š ç½‘ç›˜é“¾æ¥ï¼š</strong><br>
                                <a href="https://pan.baidu.com/s/17lRCTMocne1VhMvQ31D6RQ?pwd=amc8" target="_blank" class="text-blue-600 hover:text-blue-800">
                                    https://pan.baidu.com/s/17lRCTMocne1VhMvQ31D6RQ?pwd=amc8
                                </a>
                            </p>
                            <p class="text-gray-700 mb-4">
                                <strong>ğŸ”‘ æå–ç ï¼š</strong>
                                <span class="modal-extract-code font-mono bg-gray-100 px-2 py-1 rounded">amc8</span>
                            </p>
                            <button onclick="copyResourcesInfo(this)" 
                                    class="copy-btn flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all">
                                <i class="fas fa-copy"></i>
                                <span>å¤åˆ¶å…è´¹èµ„æ–™é“¾æ¥</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æ™®é€šç”¨æˆ·åŠ ç¾¤é¢†å–å…è´¹èµ„æ–™åŒºåŸŸ -->
                    <div id="free-resources-join" class="modal-link-box">
                        <div class="text-center">
                            <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <i class="fas fa-users text-blue-500 text-2xl mb-2"></i>
                                <h5 class="font-medium text-blue-700 mb-2">åŠ å…¥å­¦ä¹ ç¾¤å…è´¹é¢†å–</h5>
                                <p class="text-sm text-blue-600">æ‰«æä¸‹æ–¹äºŒç»´ç ï¼Œæ·»åŠ è€å¸ˆå¾®ä¿¡ï¼Œå›å¤"å…è´¹èµ„æ–™"å³å¯è·å–</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="text-center">
                                    <img src="assets/images/ä¸ªäººå¾®ä¿¡.jpg" alt="è€å¸ˆå¾®ä¿¡äºŒç»´ç " class="w-32 h-32 mx-auto rounded-lg shadow-md mb-2">
                                    <p class="text-xs text-gray-500">æ·»åŠ è€å¸ˆå¾®ä¿¡</p>
                                </div>
                                <div class="text-center">
                                    <img src="assets/images/AMC8-MYå¼ºåŒ–ç­ä»‹ç».png" alt="è¯¾ç¨‹ç¾¤äºŒç»´ç " class="w-32 h-32 mx-auto rounded-lg shadow-md mb-2">
                                    <p class="text-xs text-gray-500">äº†è§£è¯¾ç¨‹è¯¦æƒ…</p>
                                </div>
                            </div>
                            
                            <button onclick="closeModal('resources-modal'); openModal('study-group-modal')" 
                                    class="flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all">
                                <i class="fas fa-users"></i>
                                <span>ç«‹å³åŠ å…¥å­¦ä¹ ç¾¤</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-amber-50 border-l-4 border-amber-400 rounded">
                        <p class="text-sm text-amber-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            æ³¨æ„ï¼šä»¥ä¸Šå…è´¹èµ„æ–™æ¥æºäºç½‘ç»œï¼Œä»…ä¾›è‡ªç”¨äº¤æµå­¦ä¹  ğŸŒŸ
                        </p>
                    </div>
                </div>

                <!-- åˆ†éš”çº¿ -->
                <div class="my-8 border-t border-gray-200"></div>

                <!-- é­”æ¸Šå†…éƒ¨ä¸“ç ”èµ„æ–™åŒ… -->
                <div class="modal-resources premium-resources-section">
                    <h4>
                        <i class="fas fa-microscope mr-2 text-purple-600"></i>
                        Jeffè€å¸ˆä¸“ç ”èµ„æ–™åŒ…
                    </h4>
                    <p class="text-gray-600 mb-4">
                        ğŸ”¬ æ•™ç ”å›¢é˜Ÿç²¾å¿ƒç ”å‘ï¼Œä¸“ä¸šè§£æä¸ç»ƒä¹ é¢˜é›†
                    </p>
                    
                    <!-- å†…éƒ¨ä¸“ç ”èµ„æ–™é¢„è§ˆå›¾ç‰‡åŒºåŸŸ -->
                    <div class="resources-preview-container mb-6">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="resource-preview-item">
                                <img src="assets/images/resource-preview-3.jpg" alt="è§£æç­”æ¡ˆé¢„è§ˆ" class="w-full h-48 object-cover rounded-lg shadow-md">
                                <p class="text-xs text-gray-500 text-center mt-1">è¯¦ç»†è§£æç­”æ¡ˆ</p>
                            </div>
                            <div class="resource-preview-item">
                                <img src="assets/images/resource-preview-4.jpg" alt="ç»ƒä¹ é¢˜é›†é¢„è§ˆ" class="w-full h-48 object-cover rounded-lg shadow-md">
                                <p class="text-xs text-gray-500 text-center mt-1">ä¸“é¡¹ç»ƒä¹ é¢˜é›†</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å†…æµ‹é˜¶æ®µæç¤ºåŒºåŸŸ -->
                    <div class="modal-link-box premium-preview-section">
                        <div class="text-center">
                            <div class="mb-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                                <i class="fas fa-flask text-purple-500 text-2xl mb-3"></i>
                                <h5 class="font-medium text-purple-700 mb-2">åŠ©åŠ›é«˜åˆ†å†²åˆº âœ¨</h5>
                                <div class="bg-purple-100 rounded-lg p-3">
                                    <p class="text-sm text-purple-700 font-medium">
                                        â­ ä¸“ä¸ºAMC8å‰ 5% å†²åˆºç¼–å†™<br>
                                        â­ æ¢¯åº¦è®­ç»ƒ é€‚åˆä¸ªæ€§åŒ–å­¦ä¹ 
                                    </p>
                                </div>
                            </div>
                            
                            <button class="flex items-center justify-center space-x-2 mx-auto px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-all cursor-not-allowed opacity-75" disabled>
                                <i class="fas fa-hourglass-half"></i>
                                <span>å†…éƒ¨èµ„æ–™ï¼Œè¯¾ç¨‹ä¸“ç”¨</span>
                            </button>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ å…¥å­¦ä¹ ç¾¤å¼¹çª— -->
    <div id="study-group-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-users mr-2 text-purple-600"></i>
                    åŠ å…¥å­¦ä¹ ç¾¤
                </h3>
                <button class="modal-close" onclick="closeModal('study-group-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-gray-600 mb-4">åŠ å…¥æˆ‘ä»¬çš„å­¦ä¹ ç¾¤ï¼Œä¸ä¼˜ç§€å­¦å‘˜ä¸€èµ·è¿›æ­¥ï¼</p>
                
                <div class="modal-dual-images">
                    <div>
                        <img src="assets/images/AMC8-MYå¼ºåŒ–ç­ä»‹ç».png" alt="AMC8å¼ºåŒ–ç­ä»‹ç»">
                        <div class="modal-image-label">è¯¾ç¨‹ä»‹ç»</div>
                    </div>
                    <div>
                        <img src="assets/images/ä¸ªäººå¾®ä¿¡.jpg" alt="ä¸ªäººå¾®ä¿¡äºŒç»´ç ">
                        <div class="modal-image-label">æ·»åŠ è€å¸ˆå¾®ä¿¡</div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-purple-50 border-l-4 border-purple-400 rounded">
                    <p class="text-sm text-purple-800">
                        <i class="fas fa-star mr-2"></i>
                        æ‰«æå³ä¾§äºŒç»´ç æ·»åŠ è€å¸ˆå¾®ä¿¡ï¼Œè·å–å­¦ä¹ ç¾¤é‚€è¯·å’Œä¸“ä¸šæŒ‡å¯¼
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // åŠ¨æ€åŠ è½½JavaScriptæ–‡ä»¶ - ç¯å¢ƒé€‚é…
        function loadScriptsWithFallback() {
            const isDeployed = window.location.hostname !== 'localhost' && 
                              window.location.hostname !== '127.0.0.1' &&
                              !window.location.protocol.includes('file:');
            
            const basePath = isDeployed ? 'js/' : 'assets/js/';
            const scripts = ['test-engine.js', 'scoring-engine.js', 'result-display.js'];
            
            return Promise.all(scripts.map(scriptName => {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = basePath + scriptName;
                    script.onload = () => {
                        console.log(`å·²åŠ è½½: ${basePath}${scriptName}`);
                        resolve();
                    };
                    script.onerror = (error) => {
                        console.error(`åŠ è½½å¤±è´¥: ${basePath}${scriptName}`, error);
                        reject(new Error(`æ— æ³•åŠ è½½ ${basePath}${scriptName}`));
                    };
                    document.head.appendChild(script);
                });
            }));
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œè„šæœ¬åŠ è½½å’Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('å¼€å§‹åŠ è½½JavaScriptä¾èµ–...');
                await loadScriptsWithFallback();
                console.log('JavaScriptä¾èµ–åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç»“æœé¡µé¢...');
                
                // ç°åœ¨å¯ä»¥å®‰å…¨åœ°åˆå§‹åŒ–ç»“æœé¡µé¢
                await initializeResultPage();
            } catch (error) {
                console.error('JavaScriptä¾èµ–åŠ è½½å¤±è´¥:', error);
                alert('ç³»ç»ŸåŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°æµ‹è¯•ã€‚é”™è¯¯è¯¦æƒ…ï¼š' + error.message);
                window.location.href = 'index.html';
            }
        });

        // å°†åŸæ¥çš„åˆå§‹åŒ–ä»£ç ç§»åˆ°å•ç‹¬çš„å‡½æ•°ä¸­
        async function initializeResultPage() {
            try {
                console.log('å¼€å§‹åˆå§‹åŒ–ç»“æœé¡µé¢...');
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æµ‹è¯•ç»“æœ
                console.log('æ­£åœ¨åŠ è½½localStorageæ•°æ®...');
                const answers = JSON.parse(localStorage.getItem('amc8_test_answers') || '{}');
                const userInfo = JSON.parse(localStorage.getItem('amc8_user_info') || '{}');
                console.log('localStorageæ•°æ®åŠ è½½æˆåŠŸ', { answersKeys: Object.keys(answers), userInfo });
                
                // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°å…¨å±€å˜é‡
                globalUserInfo = userInfo;
                
                // æ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·ä¿¡æ¯ï¼ˆè¡¨ç¤ºç»è¿‡äº†æµ‹è¯•æµç¨‹ï¼‰
                // å…è®¸0ä¸ªç­”æ¡ˆçš„æƒ…å†µï¼Œè¿™è¡¨ç¤ºç”¨æˆ·äº¤äº†ç™½å·
                if (!userInfo.name || !userInfo.phone) {
                    console.log('ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´ï¼Œé‡å®šå‘åˆ°é¦–é¡µ');
                    alert('æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•è®°å½•ï¼Œè¯·å…ˆå¼€å§‹æµ‹è¯•');
                    window.location.href = 'index.html';
                    return;
                }
                
                // è®°å½•ç­”æ¡ˆæ•°é‡ç”¨äºè°ƒè¯•
                const answerCount = Object.keys(answers).filter(key => !key.startsWith('_')).length;
                console.log(`ç”¨æˆ·ç­”é¢˜æ•°é‡: ${answerCount}/25`);

                // æ£€æŸ¥æ˜¯å¦ä¸ºæµ‹è¯•æ¨¡å¼
                const isTestMode = localStorage.getItem('amc8_test_mode') === 'true';
                console.log('æµ‹è¯•æ¨¡å¼çŠ¶æ€:', isTestMode);
                
                try {
                    console.log('å¼€å§‹æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º...');
                    // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                    if (userInfo.name) {
                        let userInfoText = `${userInfo.name} | ${userInfo.grade}å¹´çº§`;
                        if (isTestMode) {
                            userInfoText += ' | ğŸ§ª æµ‹è¯•æ¨¡å¼';
                        }
                        const userInfoElement = document.getElementById('user-info');
                        if (userInfoElement) {
                            userInfoElement.textContent = userInfoText;
                            console.log('ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºæˆåŠŸ');
                        } else {
                            console.warn('æœªæ‰¾åˆ°user-infoå…ƒç´ ');
                        }
                        
                        // æ›´æ–°ç¥è´ºæ¨ªå¹…
                        console.log('å¼€å§‹æ›´æ–°ç¥è´ºæ¨ªå¹…...');
                        updateCongratulationsBanner(userInfo);
                        console.log('ç¥è´ºæ¨ªå¹…æ›´æ–°å®Œæˆ');
                    }

                    // å¦‚æœæ˜¯æµ‹è¯•æ¨¡å¼ï¼Œæ˜¾ç¤ºæµ‹è¯•æ¨¡å¼æç¤º
                    if (isTestMode) {
                        console.log('æ˜¾ç¤ºæµ‹è¯•æ¨¡å¼é€šçŸ¥...');
                        showTestModeNotification(userInfo);
                        console.log('æµ‹è¯•æ¨¡å¼é€šçŸ¥æ˜¾ç¤ºå®Œæˆ');
                    }
                } catch (uiError) {
                    console.error('UIæ›´æ–°å¤±è´¥:', uiError);
                    throw uiError;
                }

                try {
                    console.log('å¼€å§‹åˆå§‹åŒ–è¯„åˆ†å¼•æ“...');
                    // æ£€æŸ¥ScoringEngineæ˜¯å¦å·²å®šä¹‰
                    if (typeof ScoringEngine === 'undefined') {
                        throw new Error('ScoringEngineæœªå®šä¹‰ï¼Œå¯èƒ½æ˜¯scoring-engine.jsåŠ è½½å¤±è´¥');
                    }
                    
                    // åˆå§‹åŒ–è¯„åˆ†å¼•æ“
                    const scoringEngine = new ScoringEngine();
                    await scoringEngine.initialize();
                    console.log('è¯„åˆ†å¼•æ“åˆå§‹åŒ–å®Œæˆ');

                    console.log('å¼€å§‹ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š...');
                    // ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
                    const report = scoringEngine.generateFullReport(answers, userInfo);
                    console.log('æµ‹è¯•æŠ¥å‘Šç”Ÿæˆå®Œæˆ:', report);
                    
                    // ä¿å­˜æŠ¥å‘Šåˆ°å…¨å±€å˜é‡
                    globalReport = report;
                } catch (scoringError) {
                    console.error('è¯„åˆ†å¼•æ“å¤±è´¥:', scoringError);
                    throw scoringError;
                }
                
                try {
                    console.log('å¼€å§‹æ˜¾ç¤ºæµ‹è¯•ç»“æœ...');
                    // æ£€æŸ¥ResultDisplayæ˜¯å¦å·²å®šä¹‰
                    if (typeof ResultDisplay === 'undefined') {
                        throw new Error('ResultDisplayæœªå®šä¹‰ï¼Œå¯èƒ½æ˜¯result-display.jsåŠ è½½å¤±è´¥');
                    }
                    
                    // æ˜¾ç¤ºç»“æœ
                    const resultDisplay = new ResultDisplay();
                    window.resultDisplay = resultDisplay; // ä¿å­˜å¼•ç”¨ä¾›PDFå¯¼å‡ºä½¿ç”¨
                    resultDisplay.displayResults(globalReport);
                    console.log('æµ‹è¯•ç»“æœæ˜¾ç¤ºå®Œæˆ');
                    
                    console.log('å¼€å§‹è®¾ç½®è¿›åº¦æ¡å’Œæ–¹å—ç½‘æ ¼...');
                    // è®¾ç½®è¿›åº¦æ¡ï¼ˆHTMLæ˜¾ç¤ºï¼‰
                    setScoreProgressBar(globalReport.percentage);
                    
                    // è®¾ç½®æ–¹å—ç½‘æ ¼ï¼ˆPDFä¸“ç”¨ï¼‰
                    setScoreBlocks(globalReport);
                    console.log('è¿›åº¦æ¡å’Œæ–¹å—ç½‘æ ¼è®¾ç½®å®Œæˆ');
                    
                    console.log('ç»“æœé¡µé¢åˆå§‹åŒ–å®Œå…¨æˆåŠŸ');
                } catch (displayError) {
                    console.error('ç»“æœæ˜¾ç¤ºå¤±è´¥:', displayError);
                    throw displayError;
                }

            } catch (error) {
                console.error('åˆå§‹åŒ–ç»“æœé¡µé¢å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦ç»†ä¿¡æ¯:', error.message);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                alert('ç»“æœé¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°æµ‹è¯•ã€‚é”™è¯¯è¯¦æƒ…ï¼š' + error.message);
                window.location.href = 'index.html';
            }
        }
    </script>
    
    <script>
        // å›¾ç‰‡è·¯å¾„ç¯å¢ƒæ£€æµ‹å’Œè‡ªåŠ¨é€‚é…
        function getImagePath() {
            // æ£€æµ‹æ˜¯å¦ä¸ºéƒ¨ç½²ç¯å¢ƒ
            const isDeployed = window.location.hostname !== 'localhost' && 
                              window.location.hostname !== '127.0.0.1' &&
                              !window.location.hostname.includes('file://') &&
                              window.location.protocol !== 'file:';
            
            return isDeployed ? 'images/' : 'assets/images/';
        }

        // åŠ¨æ€æ›´æ–°å›¾ç‰‡è·¯å¾„
        function updateImagePaths() {
            const imagePath = getImagePath();
            const images = document.querySelectorAll('img[src*="assets/images/"], img[src*="images/"]');
            
            images.forEach(img => {
                const srcParts = img.src.split('/');
                const filename = srcParts[srcParts.length - 1];
                // åªæ›´æ–°åŒ…å«æˆ‘ä»¬ç›®æ ‡è·¯å¾„çš„å›¾ç‰‡
                if (img.src.includes('assets/images/') || img.src.includes('images/')) {
                    img.src = imagePath + filename;
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œè·¯å¾„æ›´æ–°
        document.addEventListener('DOMContentLoaded', updateImagePaths);
    </script>
    
    <script>
        // å¼¹çª—åŠŸèƒ½å‡½æ•°
        async function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                // å¦‚æœæ˜¯å­¦ä¹ èµ„æ–™æ¨¡æ€æ¡†ï¼Œéœ€è¦æ£€æŸ¥ç”¨æˆ·æƒé™
                if (modalId === 'resources-modal') {
                    await checkUserPermissionAndShowResources();
                }
                
                modal.classList.add('show');
                document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            }
        }

        // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                closeModal(event.target.id);
            }
        });

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // æŸ¥æ‰¾å½“å‰æ‰“å¼€çš„å¼¹çª—å¹¶å…³é—­
                const openModal = document.querySelector('.modal-overlay.show');
                if (openModal) {
                    closeModal(openModal.id);
                }
            }
        });

        // å¤åˆ¶å­¦ä¹ èµ„æ–™ä¿¡æ¯åŠŸèƒ½
        function copyResourcesInfo(button) {
            const resourcesText = `ğŸ“š é€šè¿‡ç™¾åº¦ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼š  
âœ¨ Aopsæ•°å­¦ç«èµ›23æœ¬å…¨å¥—æ•™æå¸¦ç­”æ¡ˆ + AMCçœŸé¢˜åº“  

ğŸ”— é“¾æ¥: https://pan.baidu.com/s/17lRCTMocne1VhMvQ31D6RQ?pwd=amc8  
ğŸ”‘ æå–ç : amc8`;
            
            copyToClipboard(resourcesText, button);
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
        function copyToClipboard(text, button) {
            // ç°ä»£æµè§ˆå™¨ä½¿ç”¨ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopySuccess(button, text);
                }).catch((err) => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopy(text, button);
                });
            } else {
                // å…¼å®¹æ—§æµè§ˆå™¨
                fallbackCopy(text, button);
            }
        }

        // å…¼å®¹æ–¹æ¡ˆï¼šåˆ›å»ºä¸´æ—¶inputå…ƒç´ å¤åˆ¶
        function fallbackCopy(text, button) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess(button, text);
                } else {
                    showCopyError();
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showCopyError();
            }
            
            document.body.removeChild(textArea);
        }

        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæ•ˆæœ
        function showCopySuccess(button, text) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const originalHTML = button.innerHTML;
            button.classList.add('copied');
            button.innerHTML = '<i class="fas fa-check"></i><span>å·²å¤åˆ¶</span>';
            
            // æ˜¾ç¤ºtoastæç¤º
            showToast(`å·²å¤åˆ¶ï¼š${text.length > 50 ? text.substring(0, 50) + '...' : text}`);
            
            // 2ç§’åæ¢å¤æŒ‰é’®çŠ¶æ€
            setTimeout(() => {
                button.classList.remove('copied');
                button.innerHTML = originalHTML;
            }, 2000);
        }

        // æ˜¾ç¤ºå¤åˆ¶é”™è¯¯
        function showCopyError() {
            showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
        }

        // æ˜¾ç¤ºtoastæç¤º
        function showToast(message, type = 'success') {
            // ç§»é™¤ç°æœ‰toast
            const existingToast = document.querySelector('.copy-toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // åˆ›å»ºæ–°toast
            const toast = document.createElement('div');
            toast.className = 'copy-toast';
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} mr-2"></i>${message}`;
            
            if (type === 'error') {
                toast.style.background = 'rgba(239, 68, 68, 0.95)';
                toast.style.boxShadow = '0 8px 25px rgba(239, 68, 68, 0.3)';
            }
            
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // 3ç§’åéšè—
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // å…¨å±€å˜é‡å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œæµ‹è¯•æŠ¥å‘Š
        let globalUserInfo = {};
        let globalReport = {};

        // æ£€æŸ¥ç”¨æˆ·æƒé™å¹¶æ˜¾ç¤ºå¯¹åº”èµ„æº
        async function checkUserPermissionAndShowResources() {
            try {
                // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
                const userInfo = JSON.parse(localStorage.getItem('amc8_user_info') || '{}');
                const answers = JSON.parse(localStorage.getItem('amc8_test_answers') || '{}');
                const phoneNumber = userInfo.phone || '';
                
                console.log('æ£€æŸ¥ç”¨æˆ·æƒé™ï¼Œæ‰‹æœºå·ï¼š', phoneNumber);
                
                if (!phoneNumber) {
                    // æ²¡æœ‰æ‰‹æœºå·ï¼Œæ˜¾ç¤ºæ™®é€šç”¨æˆ·ç•Œé¢
                    showRegularUserResources();
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆäº†æµ‹è¯•
                const hasCompletedTest = Object.keys(answers).filter(key => !key.startsWith('_')).length > 0;
                console.log('ç”¨æˆ·æ˜¯å¦å®Œæˆæµ‹è¯•ï¼š', hasCompletedTest);
                
                // æ£€æŸ¥JSONæ–‡ä»¶ä¸­çš„VIPç”¨æˆ·åˆ—è¡¨
                let isVIPUser = false;
                try {
                    const response = await fetch('assets/data/registered-users.json');
                    if (response.ok) {
                        const userData = await response.json();
                        const registeredUser = userData.registeredUsers.find(user => user.phone === phoneNumber);
                        
                        if (registeredUser && (registeredUser.permission === 'vip' || registeredUser.permission === 'premium')) {
                            isVIPUser = true;
                            console.log('å‘ç°VIPç”¨æˆ·ï¼š', registeredUser.name, 'æƒé™ï¼š', registeredUser.permission);
                            showCompletedUserResources(registeredUser);
                            return;
                        }
                    }
                } catch (error) {
                    console.warn('æ— æ³•åŠ è½½VIPç”¨æˆ·åˆ—è¡¨ï¼š', error);
                }
                
                // å¦‚æœä¸æ˜¯VIPç”¨æˆ·ï¼Œä½†å·²å®Œæˆæµ‹è¯•ï¼Œå¯ä»¥ä¸‹è½½å…è´¹èµ„æ–™
                if (hasCompletedTest) {
                    console.log('ç”¨æˆ·å·²å®Œæˆæµ‹è¯•ï¼Œæ˜¾ç¤ºå…è´¹èµ„æ–™ä¸‹è½½ç•Œé¢');
                    showCompletedUserResources({name: userInfo.name, phone: phoneNumber, permission: 'completed_test'});
                } else {
                    console.log('ç”¨æˆ·æœªå®Œæˆæµ‹è¯•ï¼Œæ˜¾ç¤ºæ™®é€šç”¨æˆ·ç•Œé¢');
                    showRegularUserResources();
                }
                
            } catch (error) {
                console.error('æƒé™éªŒè¯å¤±è´¥ï¼š', error);
                showRegularUserResources(); // å‡ºé”™æ—¶æ˜¾ç¤ºæ™®é€šç”¨æˆ·ç•Œé¢
            }
        }

        // æ˜¾ç¤ºå®Œæˆæµ‹è¯•ç”¨æˆ·èµ„æºï¼ˆå¯ä¸‹è½½å…è´¹èµ„æ–™ï¼‰
        function showCompletedUserResources(userInfo) {
            // æ˜¾ç¤ºå…è´¹èµ„æ–™ä¸‹è½½åŒºåŸŸ
            const freeDownloadSection = document.getElementById('free-resources-download');
            const freeJoinSection = document.getElementById('free-resources-join');
            
            if (freeDownloadSection && freeJoinSection) {
                freeDownloadSection.style.display = 'block';
                freeJoinSection.style.display = 'none';
                
                // æ ¹æ®æƒé™ç±»å‹æ›´æ–°æç¤ºæ–‡æœ¬
                const freeBadge = freeDownloadSection.querySelector('.mb-3.p-2');
                if (freeBadge && userInfo.permission === 'vip') {
                    freeBadge.innerHTML = '<i class="fas fa-crown text-yellow-500 mr-2"></i><span class="text-green-700 font-medium">VIPç”¨æˆ·ä¸“äº«ï¼Œå…è´¹ä¸‹è½½</span>';
                }
                
                console.log(`æ˜¾ç¤ºå®Œæˆæµ‹è¯•ç”¨æˆ·å…è´¹èµ„æ–™ä¸‹è½½ - ${userInfo.name} (${userInfo.permission})`);
            }
            
            // å†…éƒ¨ä¸“ç ”èµ„æ–™æ°¸è¿œåªæ˜¾ç¤ºé¢„è§ˆï¼ˆå†…æµ‹é˜¶æ®µï¼‰
            console.log('å†…éƒ¨ä¸“ç ”èµ„æ–™ï¼šæ˜¾ç¤ºé¢„è§ˆæ¨¡å¼ï¼ˆå†…æµ‹é˜¶æ®µï¼‰');
        }

        // æ˜¾ç¤ºæ™®é€šç”¨æˆ·èµ„æºï¼ˆéœ€è¦åŠ ç¾¤ï¼‰
        function showRegularUserResources() {
            // æ˜¾ç¤ºå…è´¹èµ„æ–™åŠ ç¾¤å¼•å¯¼
            const freeDownloadSection = document.getElementById('free-resources-download');
            const freeJoinSection = document.getElementById('free-resources-join');
            
            if (freeDownloadSection && freeJoinSection) {
                freeDownloadSection.style.display = 'none';
                freeJoinSection.style.display = 'block';
                
                console.log('æ˜¾ç¤ºæ™®é€šç”¨æˆ·å…è´¹èµ„æ–™åŠ ç¾¤ç•Œé¢');
            }
            
            // å†…éƒ¨ä¸“ç ”èµ„æ–™æ°¸è¿œåªæ˜¾ç¤ºé¢„è§ˆï¼ˆå†…æµ‹é˜¶æ®µï¼‰
            console.log('å†…éƒ¨ä¸“ç ”èµ„æ–™ï¼šæ˜¾ç¤ºé¢„è§ˆæ¨¡å¼ï¼ˆå†…æµ‹é˜¶æ®µï¼‰');
        }

        // è®¾ç½®è¿›åº¦æ¡å®½åº¦å’Œæ ·å¼ï¼ˆHTMLæ˜¾ç¤ºï¼‰
        function setScoreProgressBar(percentage) {
            const progressFill = document.getElementById('score-progress-fill');
            
            if (progressFill) {
                // è®¾ç½®è¿›åº¦æ¡å®½åº¦
                progressFill.style.width = percentage + '%';
                
                // æ ¹æ®ç™¾åˆ†æ¯”è®¾ç½®é¢œè‰² - ä½¿ç”¨çº¯è‰²ç¡®ä¿PDFå…¼å®¹æ€§
                let color;
                if (percentage >= 80) {
                    color = '#10b981'; // green
                } else if (percentage >= 60) {
                    color = '#3b82f6'; // blue  
                } else if (percentage >= 40) {
                    color = '#f59e0b'; // orange
                } else {
                    color = '#ef4444'; // red
                }
                
                // ä½¿ç”¨çº¯è‰²è€Œä¸æ˜¯æ¸å˜ï¼Œç¡®ä¿PDFå…¼å®¹æ€§
                progressFill.style.background = color;
                
                // å¼ºåˆ¶PDFé¢œè‰²ä¿æŠ¤
                progressFill.style.webkitPrintColorAdjust = 'exact';
                progressFill.style.colorAdjust = 'exact';
                
                console.log(`è®¾ç½®è¿›åº¦æ¡: ${percentage}% -> å®½åº¦:${percentage}%, é¢œè‰²:${color}`);
            }
        }
        
        // è®¾ç½®æ–¹å—ç½‘æ ¼æ˜¾ç¤ºï¼ˆPDFä¸“ç”¨ï¼‰
        function setScoreBlocks(report) {
            const blocksGrid = document.getElementById('score-blocks-grid');
            const statCorrect = document.getElementById('stat-correct');
            const statWrong = document.getElementById('stat-wrong');
            const statAccuracy = document.getElementById('stat-accuracy');
            
            if (blocksGrid && report) {
                // æ¸…ç©ºç°æœ‰æ–¹å—
                blocksGrid.innerHTML = '';
                
                // ç”Ÿæˆ25ä¸ªæ–¹å—
                for (let i = 1; i <= 25; i++) {
                    const block = document.createElement('div');
                    block.className = 'score-block';
                    block.textContent = i;
                    
                    if (i <= report.correctAnswers) {
                        block.classList.add('correct');
                    } else if (i <= report.answeredQuestions) {
                        block.classList.add('incorrect');
                    } else {
                        block.classList.add('unanswered');
                        block.textContent = '-';
                    }
                    
                    blocksGrid.appendChild(block);
                }
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                if (statCorrect) statCorrect.textContent = report.correctAnswers;
                if (statWrong) statWrong.textContent = report.answeredQuestions - report.correctAnswers;
                if (statAccuracy) statAccuracy.textContent = Math.round(report.percentage) + '%';
                
                console.log(`è®¾ç½®æ–¹å—ç½‘æ ¼: æ­£ç¡®${report.correctAnswers}é¢˜, æ€»ç­”${report.answeredQuestions}é¢˜`);
            }
        }

        // æ›´æ–°ç¥è´ºæ¨ªå¹…
        function updateCongratulationsBanner(userInfo) {
            const nameElement = document.getElementById('congratulations-name');
            const gradeElement = document.getElementById('congratulations-grade');
            const gradeTextElement = document.getElementById('grade-text');
            const messageElement = document.getElementById('congratulations-message');
            
            if (userInfo.name) {
                // å°†å¹´çº§ä¿¡æ¯ç›´æ¥é›†æˆåˆ°å§“åä¸­ï¼Œä½¿ç”¨æ›´ç´§å‡‘çš„å¸ƒå±€
                if (userInfo.grade) {
                    nameElement.innerHTML = `æ­å–œ ${userInfo.name} åŒå­¦ï¼ <span class="inline-flex items-center ml-3 px-3 py-1 text-sm bg-white bg-opacity-20 rounded-full border border-white border-opacity-30"><i class="fas fa-graduation-cap mr-1"></i>${userInfo.grade}å¹´çº§</span>`;
                    gradeElement.style.display = 'none'; // éšè—åŸæ¥çš„å¹´çº§å…ƒç´ 
                } else {
                    nameElement.textContent = `æ­å–œ ${userInfo.name} åŒå­¦ï¼`;
                    gradeElement.style.display = 'none';
                }
                
                messageElement.textContent = 'æ„Ÿè°¢æ‚¨å®ŒæˆAMC8ç­å‰æµ‹è¯•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ‚¨çš„ç²¾å½©è¡¨ç°å§ï¼';
            } else {
                nameElement.textContent = 'æ­å–œå®Œæˆæµ‹è¯•ï¼';
                gradeElement.style.display = 'none';
                messageElement.textContent = 'æ„Ÿè°¢æ‚¨å®ŒæˆAMC8ç­å‰æµ‹è¯•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹æ‚¨çš„ç²¾å½©è¡¨ç°å§ï¼';
            }
        }

        // å¯¼å‡ºPDFåŠŸèƒ½
        document.getElementById('export-pdf').addEventListener('click', async function() {
            // ç”Ÿæˆå¸¦ç”¨æˆ·ä¿¡æ¯çš„PDFæ–‡ä»¶å
            const fileName = generatePDFFileName();
            
            // æš‚æ—¶æ›´æ–°é¡µé¢æ ‡é¢˜ä¸ºPDFæ–‡ä»¶å
            const originalTitle = document.title;
            document.title = fileName;
            
            // é¢˜ç›®å†…å®¹å·²ç§»è‡³ç‹¬ç«‹é¡µé¢ questions-review.html
            // PDFå¯¼å‡ºåªåŒ…å«æˆç»©å•ï¼Œä¸åŒ…å«é¢˜ç›®å†…å®¹
            console.log('PDFå¯¼å‡ºï¼šæˆç»©å•æ¨¡å¼ï¼ˆä¸åŒ…å«é¢˜ç›®å†…å®¹ï¼‰');
            
            // ç¡®ä¿å›¾è¡¨å·²å‡†å¤‡å¥½å†æ‰“å°
            preparePrintCharts().then(() => {
                // æ·»åŠ æ‰“å°å‰çš„å‡†å¤‡å·¥ä½œ
                document.body.classList.add('printing');
                
                // æ‰§è¡Œæ‰“å°
                window.print();
                
                // æ‰“å°å®Œæˆåæ¸…ç†
                setTimeout(() => {
                    document.body.classList.remove('printing');
                    // æ¢å¤åŸæ ‡é¢˜
                    document.title = originalTitle;
                }, 1000);
            }).catch(error => {
                console.error('å‡†å¤‡æ‰“å°å›¾è¡¨å¤±è´¥:', error);
                // å³ä½¿å‡ºé”™ä¹Ÿå…è®¸æ‰“å°
                window.print();
                // æ¢å¤åŸæ ‡é¢˜
                document.title = originalTitle;
            });
        });

        // ç”ŸæˆPDFæ–‡ä»¶å
        function generatePDFFileName() {
            const userInfo = globalUserInfo;
            const report = globalReport;
            const currentDate = new Date();
            
            // æ ¼å¼åŒ–æ—¥æœŸ
            const dateStr = currentDate.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).replace(/\//g, '-');
            
            let fileName = '';
            
            if (userInfo.name) {
                // å¦‚æœæœ‰ç”¨æˆ·å§“åï¼ŒåŒ…å«åœ¨æ–‡ä»¶åä¸­
                fileName = `${userInfo.name}_AMC8æµ‹è¯•æŠ¥å‘Š_${dateStr}`;
                
                // å¦‚æœæœ‰å¹´çº§ä¿¡æ¯ï¼Œä¹Ÿæ·»åŠ åˆ°æ–‡ä»¶åä¸­
                if (userInfo.grade) {
                    fileName = `${userInfo.name}_${userInfo.grade}å¹´çº§_AMC8æµ‹è¯•æŠ¥å‘Š_${dateStr}`;
                }
                
                // å¦‚æœæœ‰åˆ†æ•°ä¿¡æ¯ï¼Œæ·»åŠ åˆ†æ•°
                if (report && report.score !== undefined) {
                    fileName = `${userInfo.name}_AMC8æµ‹è¯•æŠ¥å‘Š_${report.score}åˆ†_${dateStr}`;
                    
                    if (userInfo.grade) {
                        fileName = `${userInfo.name}_${userInfo.grade}å¹´çº§_AMC8æµ‹è¯•æŠ¥å‘Š_${report.score}åˆ†_${dateStr}`;
                    }
                }
            } else {
                // å¦‚æœæ²¡æœ‰ç”¨æˆ·å§“åï¼Œä½¿ç”¨é€šç”¨æ ¼å¼
                if (report && report.score !== undefined) {
                    fileName = `AMC8æµ‹è¯•æŠ¥å‘Š_${report.score}åˆ†_${dateStr}`;
                } else {
                    fileName = `AMC8æµ‹è¯•æŠ¥å‘Š_${dateStr}`;
                }
            }
            
            return fileName;
        }
        
        // å‡†å¤‡æ‰“å°å›¾è¡¨
        async function preparePrintCharts() {
            return new Promise((resolve) => {
                // æ£€æŸ¥é›·è¾¾å›¾æ˜¯å¦å·²ç”Ÿæˆæ‰“å°å›¾ç‰‡
                const chartContainer = document.querySelector('.chart-container');
                const printImage = chartContainer ? chartContainer.querySelector('.print-chart-image') : null;
                
                if (printImage && printImage.src) {
                    console.log('æ‰“å°å›¾è¡¨å·²å‡†å¤‡å°±ç»ª');
                    resolve();
                } else {
                    // å¦‚æœæ²¡æœ‰æ‰“å°å›¾ç‰‡ï¼Œå°è¯•é‡æ–°ç”Ÿæˆ
                    const canvas = document.getElementById('radar-chart');
                    if (canvas && window.resultDisplay) {
                        try {
                            window.resultDisplay.generatePrintImage(canvas);
                            // ç»™å›¾ç‰‡åŠ è½½ä¸€äº›æ—¶é—´
                            setTimeout(resolve, 500);
                        } catch (error) {
                            console.warn('æ— æ³•ç”Ÿæˆæ‰“å°å›¾ç‰‡:', error);
                            resolve();
                        }
                    } else {
                        resolve();
                    }
                }
            });
        }

        // æŸ¥çœ‹é¢˜ç›®ä¸ç­”æ¡ˆ
        function viewQuestions() {
            // è·³è½¬åˆ°é¢˜ç›®ç­”æ¡ˆå¯¹ç…§é¡µé¢
            window.location.href = 'questions-review.html';
        }

        // é‡æ–°æµ‹è¯•åŠŸèƒ½
        document.getElementById('retake-test').addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦é‡æ–°æµ‹è¯•å—ï¼Ÿå½“å‰ç»“æœå°†è¢«æ¸…é™¤ã€‚')) {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„æ•°æ®
                localStorage.removeItem('amc8_test_answers');
                localStorage.removeItem('amc8_timer_state');
                
                // è·³è½¬åˆ°é¦–é¡µ
                window.location.href = 'index.html';
            }
        });

        // æ˜¾ç¤ºæµ‹è¯•æ¨¡å¼é€šçŸ¥
        function showTestModeNotification(userInfo) {
            // åˆ›å»ºæµ‹è¯•æ¨¡å¼é€šçŸ¥æ¡†
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-yellow-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 max-w-sm';
            notification.innerHTML = `
                <div class="flex items-start">
                    <i class="fas fa-flask text-xl mr-3 mt-1"></i>
                    <div>
                        <h4 class="font-bold mb-1">æµ‹è¯•æ¨¡å¼è¿è¡Œä¸­</h4>
                        <p class="text-sm">
                            ç­”æ¡ˆæ¨¡å¼: ${userInfo.answerMode || 'random'}<br>
                            ç­”é¢˜æ•°é‡: ${userInfo.answerCount || 25}é¢˜
                        </p>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                class="mt-2 text-xs bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded">
                            å…³é—­
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 10ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }
    </script>
</body>
</html>